<html>

<body>
    <link rel="stylesheet" href="style.css">
    <script src="https://d3js.org/d3.v5.min.js"></script>
    <script src="https://d3js.org/topojson.v3.min.js"></script>
    <div class="container">
        <div class="left_panel">
            <div class="filter">
                <div id='header'>
                    <h1> &#128523 Boston Bites </h1>
                    <label for="selectDistance">Distance:</label>

                    <select name="select" id="selectDistance">
                        <option value="1" selected>1 mile</option>
                        <option value="2">2 miles</option>
                        <option value="3">3 miles</option>
                        <option value="4">4 miles</option>
                        <option value="5">5 miles</option>
                        <option value="all">everywhere in Boston</option>
                    </select>
                </div>
                <div id=filter1>
                    <div class='filter1child'>
                        <h2>&#9749</h2>
                        <h3>Cafes & Bakeries</h3>
                    </div>
                    <div class='filter1child'>
                        <h2>&#129365</h2>
                        <h3>Markets</h3>
                    </div>
                    <div class='filter1child'>
                        <h2>&#127860</h2>
                        <h3>Restaurants</h3>
                    </div>
                </div>
                <div id=filter2>
                    <fieldset>
                        <legend>Pick your cuisines!</legend>
                    
                        <div>
                          <input type="checkbox" id="thai" name="thai" checked>
                          <label for="thai">Thai</label>
                        </div>
                    
                        <div>
                          <input type="checkbox" id="italian" name="italian">
                          <label for="italian">Italian</label>
                        </div>
                    </fieldset>
                </div>
            </div>

            <div id=mapContainer>
                <svg id="map" width=1000 height=700></svg>
            </div>


        </div>
        <div class="list">
            <h1> List </h1>
            <div id = listContainer>
                <svg id="svglist"></svg>
            </div>
            
        </div>
        <script>
            const getData = async function () {
                const svg = d3.select("#map");
                const width = svg.attr("width");
                const height = svg.attr("height");
                const margin = { top: 20, right: 20, bottom: 20, left: 20 };
                const mapWidth = width - margin.left - margin.right;
                const mapHeight = height - margin.top - margin.bottom;
                const map = svg.append("g")
                    .attr("transform", "translate(" + margin.left + "," + margin.top + ")");


                let data = await d3.csv("yelp_boston.csv", d3.autotype);
                const boston = await d3.json("output-2.json");

                console.log(boston);


                console.log(d3.map(data, d => d.latitude))
                data.forEach((d) => {
                    d.LAT = parseInt(d.latitude)
                    d.LONG = parseInt(d.longitude)
                    d.RATING = parseInt(d.rating)
                    d.REVIEW = parseInt(d.review_count)
                    d.CAT = JSON.parse(d.categories)
                    d.LOCATION = JSON.parse(d.location)
                    d.POSITION = [d.LOCATION['coordinate']['longitude'], d.LOCATION['coordinate']['latitude']];
                })
                console.log(data);

                var zips = topojson.feature(boston, boston.objects.Boston_Street_Segments);
                var zipsMesh = topojson.mesh(boston, boston.objects.Boston_Street_Segments);

                var states = topojson.feature(boston, boston.objects.City_of_Boston_Boundary);
                var stateMesh = topojson.mesh(boston, boston.objects.City_of_Boston_Boundary);

                var projection = d3.geoMercator().fitSize([mapWidth, mapHeight], zips);
                var path = d3.geoPath().projection(projection);


                let viewport = map.append("g");

                viewport.append("path")
                    .attr("class", "graticule")
                    .attr("d", path(d3.geoGraticule10()));


                viewport.append("path")
                    .datum(stateMesh)
                    .attr("class", "state-outline")
                    .attr("d", path);

                viewport.selectAll(".zip").data(zips.features)
                    .join("path")
                    .attr("class", "zip")
                    .attr("fill", "None")
                    .attr('stroke', 'None')
                    .attr("d", path);

                viewport.append("path")
                    .datum(zipsMesh)
                    .attr("class", "zip-outline")
                    .attr("d", path);


                viewport.selectAll("circle").data(data)
                    .join("circle")
                    .attr("class", "dots")
                    .attr("r", 1.5)
                    .attr("cx", d => projection(d.POSITION)[0])
                    .attr("cy", d => projection(d.POSITION)[1])
                    .attr("fill", "red");

                var mapZoom = d3.zoom().on("zoom", mapZoomed);
                console.log(mapZoom);

                map.call(mapZoom);

                function mapZoomed(event) {

                    viewport.attr("transform", event.transform);

                    viewport.select(".zip-outline")
                        .style("stroke-width", 1 / event.transform.k);

                    viewport.select(".dots")
                        .attr("r", 1.5 /event.transform.k)
                }

                // making a brush for the map 
                // goal is to make a default size for each mile radius (1, 2, 5)

                // appending a g tag to the map for the brush to go
                let brushGroup = map.append("g").attr("class", "brush");

                // make a brush
                let brush = d3.brush()
                    .extent([[0,0], [mapWidth, mapHeight]])
                    .on("start", startbrush)
                    .on("brush", brushed)
                    .on("end", endbrush);

                // brush functions
                let currentBrush;
                function startbrush() {
                    if (currentBrush != this) {
                        d3.select(currentBrush).call(this.brush.clear);
                        currentBrush = this;
                    }
                }

                function endbrush( {selection}) {
                    if (selection === null) {
                        updatePointAppearance();
                    }
                    else {}
                }

                function brushed({selection}) {
                    if (selection === null) return; 
                    updatePointAppearance();
                }

                // the points that are selected will change color
                function updatePointAppearance() {

                }

            }
            getData()
        </script>
</body>

</html>